{% extends "admin/base_site.html" %}
{% load i18n admin_urls static admin_modify %}

{% block title %}{{ title }} | {{ site_title|default:_('Django site admin') }}{% endblock %}

{% block breadcrumbs %}
<div class="breadcrumbs">
<a href="{% url 'admin:index' %}">{% trans 'Home' %}</a>
&rsaquo; <a href="{% url 'admin:app_list' app_label=opts.app_label %}">{{ opts.app_config.verbose_name }}</a>
&rsaquo; <a href="{% url 'admin:competitions_competition_changelist' %}">{% trans 'Competitions' %}</a>
&rsaquo; <a href="{% url 'admin:competitions_competition_change' competition.id %}">{{ competition.name }}</a>
&rsaquo; {% trans 'Schedule Game' %}
</div>
{% endblock %}

{% block content %}
<h1>{{ title }}</h1>

{% if messages %}
    <ul class="messagelist">
        {% for message in messages %}
            <li class="{{ message.tags }}">{{ message }}</li>
        {% endfor %}
    </ul>
{% endif %}

<form method="post">
    {% csrf_token %}
    
    <div class="module aligned">
        <h2>Game Details</h2>
        
        <div class="form-row">
            <div>
                <label for="home_team">Home Team *</label>
                <select name="home_team" id="home_team" required>
                    <option value="">Select Home Team</option>
                    {% for team in teams %}
                        <option value="{{ team.id }}">{{ team.name }}</option>
                    {% endfor %}
                </select>
            </div>
        </div>
        
        <div class="form-row">
            <div>
                <label for="away_team">Away Team *</label>
                <select name="away_team" id="away_team" required>
                    <option value="">Select Away Team</option>
                    {% for team in teams %}
                        <option value="{{ team.id }}">{{ team.name }}</option>
                    {% endfor %}
                </select>
            </div>
        </div>
        
        <div class="form-row">
            <div>
                <label for="game_date">Game Date *</label>
                <input type="date" name="game_date" id="game_date" required>
            </div>
        </div>
        
        <div class="form-row">
            <div>
                <label for="game_time">Game Time *</label>
                <input type="time" name="game_time" id="game_time" required>
            </div>
        </div>
    </div>
    
    <div class="submit-row">
        <input type="submit" value="Schedule Game" class="default">
        <a href="{% url 'admin:competitions_competition_change' competition.id %}" class="default">Cancel</a>
    </div>
</form>

<script>
document.addEventListener('DOMContentLoaded', function() {
    // Set default date to today
    const today = new Date().toISOString().split('T')[0];
    document.getElementById('game_date').value = today;
    
    // Set default time to 19:30 (7:30 PM)
    document.getElementById('game_time').value = '19:30';
    
    // Prevent selecting the same team for home and away
    const homeSelect = document.getElementById('home_team');
    const awaySelect = document.getElementById('away_team');
    
    function updateOptions() {
        const homeValue = homeSelect.value;
        const awayValue = awaySelect.value;
        
        // Update away team options
        Array.from(awaySelect.options).forEach(option => {
            if (option.value === homeValue && homeValue !== '') {
                option.disabled = true;
                if (awayValue === homeValue) {
                    awaySelect.value = '';
                }
            } else {
                option.disabled = false;
            }
        });
        
        // Update home team options
        Array.from(homeSelect.options).forEach(option => {
            if (option.value === awayValue && awayValue !== '') {
                option.disabled = true;
                if (homeValue === awayValue) {
                    homeSelect.value = '';
                }
            } else {
                option.disabled = false;
            }
        });
    }
    
    homeSelect.addEventListener('change', updateOptions);
    awaySelect.addEventListener('change', updateOptions);
});
</script>

{% endblock %}
